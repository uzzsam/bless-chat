{
  "version": 3,
  "sources": ["../widget/src/index.ts"],
  "sourcesContent": ["/*\n  Bless chat widget: mounts into a container that has data-chat-container attribute.\n  Exposes global BlessChat with a mount helper for flexibility, otherwise auto-mounts on DOMContentLoaded.\n*/\n\ntype Role = 'user' | 'assistant';\n\ninterface Message {\n  role: Role;\n  content: string;\n}\n\ninterface WidgetOptions {\n  apiUrl?: string;\n  placeholder?: string;\n  sendAriaLabel?: string;\n  loadingText?: string;\n  requireBlessing?: boolean;\n}\n\nconst DEFAULTS: Required<WidgetOptions> = {\n  apiUrl: 'https://bless-test-brown.vercel.app/api/chat',\n  placeholder: 'Talk to Sidthah',\n  sendAriaLabel: 'Send message',\n  loadingText: 'Listening...',\n  requireBlessing: true,\n};\n\nfunction sanitizeString(value?: string | null): string | undefined {\n  if (value === undefined || value === null) return undefined;\n  const trimmed = value.toString().trim();\n  if (!trimmed) return undefined;\n  const lower = trimmed.toLowerCase();\n  if (lower === 'undefined' || lower === 'null') return undefined;\n  return trimmed;\n}\n\n// Base styles for the chat widget.  Additional styles for option buttons are appended below.\nconst STYLE_BLOCK = `\n:root {\n  --bless-green-900: 23, 95, 75;\n  --bless-green-500: 70, 136, 111;\n  --bless-gold-400: 227, 216, 154;\n  --bless-cream-100: 236, 227, 214;\n}\n\n.bless-chat-shell {\n  width: min(820px, 92vw);\n  margin: 0 auto;\n  display: flex;\n  flex-direction: column;\n  gap: 1.75rem;\n  font-family: 'Albert Sans', 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n  color: rgba(var(--bless-cream-100), 0.92);\n}\n\n.bless-chat-window {\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  gap: 1.1rem;\n  padding: clamp(1.75rem, 3vw, 2.4rem) clamp(1.5rem, 3vw, 2.8rem);\n  border-radius: 48px;\n  background: linear-gradient(135deg, rgba(20,62,48,0.78), rgba(27,73,58,0.6));\n  box-shadow: 0 26px 70px rgba(0, 0, 0, 0.45);\n  backdrop-filter: blur(18px);\n  border: 1px solid rgba(var(--bless-gold-400), 0.38);\n  overflow: hidden;\n}\n\n.bless-chat-window::after {\n  content: '';\n  position: absolute;\n  inset: 12px;\n  border-radius: 36px;\n  border: 1px solid rgba(255,255,255,0.12);\n  pointer-events: none;\n  opacity: 0.6;\n}\n\n.bless-chat-messages {\n  display: flex;\n  flex-direction: column;\n  gap: 1.1rem;\n  max-height: min(55vh, 500px);\n  overflow-y: auto;\n  padding-right: 0.5rem;\n}\n\n.bless-chat-messages::-webkit-scrollbar {\n  width: 6px;\n}\n\n.bless-chat-messages::-webkit-scrollbar-thumb {\n  background: rgba(var(--bless-cream-100),0.35);\n  border-radius: 999px;\n}\n\n.bless-chat-bubble {\n  position: relative;\n  padding: 1.65rem clamp(1.6rem, 3.8vw, 2.6rem);\n  border-radius: 42px;\n  background: rgba(19, 63, 52, 0.72);\n  border: 1px solid rgba(var(--bless-gold-400), 0.4);\n  box-shadow: 0 18px 45px rgba(0, 0, 0, 0.35);\n  backdrop-filter: blur(14px);\n  color: rgba(var(--bless-cream-100), 0.96);\n  font-size: clamp(1.02rem, 1vw + 0.9rem, 1.2rem);\n  line-height: 1.6;\n  /* Align all message text to the left for improved readability */\n  text-align: left;\n}\n\n.bless-chat-bubble--user {\n  align-self: flex-end;\n  background: linear-gradient(120deg, rgba(28,88,70,0.6), rgba(22,65,52,0.7));\n  border: 1px solid rgba(var(--bless-green-500), 0.6);\n  color: rgba(var(--bless-cream-100), 0.9);\n}\n\n.bless-chat-bubble--status {\n  text-align: center;\n  font-size: 0.95rem;\n  color: rgba(var(--bless-cream-100), 0.65);\n  background: rgba(15, 48, 39, 0.4);\n  border: 1px solid rgba(var(--bless-green-500), 0.35);\n}\n\n.bless-chat-input-row {\n  display: flex;\n  gap: 1rem;\n  align-items: center;\n}\n\n.bless-chat-input-wrapper {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  border-radius: 999px;\n  border: 1px solid rgba(var(--bless-green-500), 0.55);\n  background: linear-gradient(120deg, rgba(21,65,53,0.78), rgba(15,52,41,0.74));\n  padding: 0.4rem 0.4rem 0.4rem 1.4rem;\n  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04);\n}\n\n.bless-chat-input {\n  flex: 1;\n  border: none;\n  background: transparent;\n  color: rgba(var(--bless-cream-100), 0.92);\n  font-size: clamp(1.05rem, 2vw, 1.2rem);\n  line-height: 1.4;\n  padding: 0.75rem 0;\n  /* Remove default background or hover effects that could turn the input white */\n  background-color: transparent !important;\n  box-shadow: none !important;\n}\n\n.bless-chat-input::placeholder {\n  color: rgba(var(--bless-cream-100), 0.45);\n  opacity: 1;\n}\n\n.bless-chat-input:focus {\n  outline: none;\n  background-color: transparent !important;\n  box-shadow: none !important;\n}\n\n/* Ensure input remains transparent on hover and focus */\n.bless-chat-input:hover,\n.bless-chat-input:focus {\n  background-color: transparent !important;\n  box-shadow: none !important;\n}\n\n.bless-chat-send {\n  flex-shrink: 0;\n  width: 64px;\n  height: 64px;\n  border-radius: 999px;\n  border: none;\n  background: radial-gradient(circle at 30% 30%, rgba(var(--bless-gold-400),0.95), rgba(var(--bless-gold-400),0.82));\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: transform 180ms ease, box-shadow 180ms ease;\n  box-shadow: 0 12px 32px rgba(0,0,0,0.32);\n}\n\n.bless-chat-send[disabled] {\n  cursor: not-allowed;\n  opacity: 0.7;\n  transform: none;\n  box-shadow: none;\n}\n\n.bless-chat-send:hover:not([disabled]),\n.bless-chat-send:focus-visible:not([disabled]) {\n  transform: translateY(-2px);\n  box-shadow: 0 18px 40px rgba(0,0,0,0.4);\n}\n\n.bless-chat-send svg {\n  width: 36px;\n  height: 20px;\n}\n\n.bless-chat-error {\n  margin-top: 0.5rem;\n  font-size: 0.95rem;\n  color: rgba(255, 129, 100, 0.88);\n  text-align: center;\n}\n\n@media (max-width: 640px) {\n  .bless-chat-shell {\n    gap: 1.25rem;\n  }\n\n  .bless-chat-window {\n    border-radius: 32px;\n    padding: 1.4rem 1.3rem;\n  }\n\n  .bless-chat-window::after {\n    inset: 8px;\n    border-radius: 26px;\n  }\n\n  .bless-chat-bubble {\n    border-radius: 30px;\n    padding: 1.3rem 1.2rem;\n  }\n\n  .bless-chat-input-wrapper {\n    padding-left: 1.1rem;\n  }\n\n  .bless-chat-send {\n    width: 56px;\n    height: 56px;\n  }\n\n  .bless-chat-options {\n    grid-template-columns: 1fr;\n  }\n}\n\n/* Additional styles for Sidthie option buttons */\n.bless-chat-options {\n  display: grid;\n  grid-template-columns: repeat(2, minmax(0, 1fr));\n  gap: 0.75rem 0.9rem;\n}\n\n.bless-chat-option {\n  display: block;\n  padding: 1.1rem clamp(1.4rem, 3.2vw, 2.3rem);\n  border-radius: 42px;\n  background: rgba(19, 63, 52, 0.72);\n  border: 1px solid rgba(var(--bless-gold-400), 0.4);\n  color: rgba(var(--bless-cream-100), 0.96);\n  font-size: clamp(0.98rem, 0.8vw + 0.9rem, 1.15rem);\n  line-height: 1.55;\n  cursor: pointer;\n  text-align: center;\n}\n\n.bless-chat-option:hover,\n.bless-chat-option:focus {\n  background: rgba(19, 63, 52, 0.85);\n}\n\n.bless-chat-bubble--status.is-typing {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.bless-typing {\n  display: inline-flex;\n  gap: 0.35rem;\n}\n\n.bless-typing span {\n  width: 8px;\n  height: 8px;\n  border-radius: 50%;\n  background: rgba(var(--bless-cream-100), 0.75);\n  animation: bless-dot 900ms ease-in-out infinite alternate;\n}\n\n.bless-typing span:nth-child(2) {\n  animation-delay: 120ms;\n}\n\n.bless-typing span:nth-child(3) {\n  animation-delay: 240ms;\n}\n\n@keyframes bless-dot {\n  from {\n    opacity: 0.35;\n    transform: translateY(0);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(-3px);\n  }\n}\n`;\n\nconst styleEl = document.createElement('style');\nstyleEl.textContent = STYLE_BLOCK;\ndocument.head.appendChild(styleEl);\n\ninterface SidthieMeta {\n  key: string;\n  label: string;\n  short: string;\n  description: string;\n}\n\nconst SIDTHIE_META: Record<string, SidthieMeta> = {\n  NALAMERA: {\n    key: 'NALAMERA',\n    label: 'Inner Strength',\n    short: 'A steady courage that rises quietly from within.',\n    description:\n      'Nalamera steadies the breath and roots the heart; she carries the quiet strength that holds families together when storms arrive.',\n  },\n  LUMASARA: {\n    key: 'LUMASARA',\n    label: 'Happiness',\n    short: 'A soft, luminous joy that brightens the ordinary.',\n    description:\n      'Lumasara brightens every ordinary moment with the glow of celebration, inviting laughter to linger like sunlight through leaves.',\n  },\n  WELAMORA: {\n    key: 'WELAMORA',\n    label: 'Love',\n    short: 'A tender presence that listens and embraces.',\n    description:\n      'Welamora listens with the whole heart, weaving warmth and devotion so love can be felt in every touch and every word.',\n  },\n  NIRALUMA: {\n    key: 'NIRALUMA',\n    label: 'Wisdom',\n    short: 'A calm clarity that sees the path with kindness.',\n    description:\n      'Niraluma pours lantern-light across the path ahead, offering gentle insight and elder grace to every decision you make.',\n  },\n  RAKAWELA: {\n    key: 'RAKAWELA',\n    label: 'Protection',\n    short: 'A gentle guard that shelters what is precious.',\n    description:\n      'Rakawela stands as a quiet guardian, wrapping loved ones in vigilant kindness and turning away every shadow that approaches.',\n  },\n  OLANWELA: {\n    key: 'OLANWELA',\n    label: 'Healing',\n    short: 'A quiet mending that restores balance and breath.',\n    description:\n      'Olanwela soothes weary hearts and tired bones, bathing the spirit in cool rivers of renewal and compassionate rest.',\n  },\n  MORASARA: {\n    key: 'MORASARA',\n    label: 'Peace',\n    short: 'A stillness that settles and softens the heart.',\n    description:\n      'Morasara settles like evening mist, inviting deep breaths, calm conversations, and the promise of belonging wherever you stand.',\n  },\n};\n\nconst SIDTHIE_VALUES = Object.values(SIDTHIE_META);\n\nfunction findSidthieByKey(key?: string | null): SidthieMeta | null {\n  if (!key) return null;\n  const upper = key.toUpperCase();\n  return SIDTHIE_META[upper] ?? null;\n}\n\nfunction findSidthieByLabel(text?: string | null): SidthieMeta | null {\n  if (!text) return null;\n  const trimmed = text.trim().toLowerCase();\n  return (\n    SIDTHIE_VALUES.find((meta) => meta.label.toLowerCase() === trimmed) ??\n    SIDTHIE_VALUES.find((meta) => trimmed.includes(meta.label.toLowerCase())) ??\n    null\n  );\n}\n\nfunction svgArrow() {\n  return `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<svg viewBox=\"0 0 120 64\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n  <g stroke=\"#175F4B\" stroke-width=\"5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n    <path d=\"M14 32H94\" />\n    <path d=\"M70 14L94 32L70 50\" />\n    <circle cx=\"106\" cy=\"32\" r=\"4.5\" fill=\"#175F4B\" stroke=\"#175F4B\" stroke-width=\"2\" />\n  </g>\n</svg>`;\n}\n\nconst SESSION_KEY = 'bless-chat-blessing-created';\n\nconst CLEAN_PATTERNS: RegExp[] = [\n  /Thank you for (sharing|uploading|providing).*?(files?|documents?|that)!?.*$/gim,\n  /How can I assist you with (them|it|the files?)\\?.*$/gim,\n  /Would you like me to search for specific information.*$/gim,\n  /or summarize the content\\?.*$/gim,\n  /\\\u3010\\d+:\\d+\u2020source\\\u3011/g,\n  /To create a personalized blessing.*?providing the files?!?/gim,\n  /and for providing the files?!?/gim\n];\n\nfunction cleanAssistantText(message: string) {\n  let cleaned = message ?? '';\n  CLEAN_PATTERNS.forEach((pattern) => {\n    cleaned = cleaned.replace(pattern, '');\n  });\n  return cleaned.trim();\n}\n\nfunction getSessionFlag(key: string) {\n  try {\n    return typeof sessionStorage !== 'undefined' ? sessionStorage.getItem(key) : null;\n  } catch {\n    return null;\n  }\n}\n\nfunction setSessionFlag(key: string, value: string) {\n  try {\n    if (typeof sessionStorage !== 'undefined') {\n      sessionStorage.setItem(key, value);\n    }\n  } catch {\n    /* ignore storage errors */\n  }\n}\n\nfunction revealBlessing(blessing: string) {\n  const sel = [\n    '[data-bless-panel]',\n    '.bless-blessing__panel',\n    '#bless-blessing__panel'\n  ].join(',');\n\n  document.querySelectorAll<HTMLElement>(sel).forEach((el) => {\n    el.style.fontFamily = \"'Cormorant Upright', serif\";\n    el.style.whiteSpace = 'pre-line';\n    el.style.textAlign = 'center';\n    el.style.color = '#fff';\n    el.style.fontSize = 'clamp(18px, 2.4vw, 30px)';\n    el.style.lineHeight = '1.35';\n    el.style.textShadow = '0 2px 8px rgba(0,0,0,.55)';\n    el.textContent = blessing;\n  });\n}\n\nfunction parseSidthieOptions(payload: string | undefined | null) {\n  if (!payload) return null;\n  const processed = payload\n    .replace(/([*\\-\u2022]?\\s*)([1-7])[\\.\\)\\:]\\s*/g, '\\n$2. ')\n    .replace(/\\s{2,}/g, ' ')\n    .trim();\n  const lines = processed.split(/\\r?\\n/).map((l) => l.trim()).filter(Boolean);\n  const optionLines = lines.filter((line) => /^[1-7]\\.\\s*/.test(line));\n  if (optionLines.length < 7) return null;\n  const introLines = lines.filter((line) => !/^[1-7]\\.\\s*/.test(line));\n  const intro = introLines.join(' ').trim();\n  const hasAll = SIDTHIE_VALUES.every((meta) => {\n    const lower = processed.toLowerCase();\n    return lower.includes(meta.label.toLowerCase()) || processed.includes(`(${meta.key})`);\n  });\n  if (!hasAll) return null;\n  const options = SIDTHIE_VALUES.map((meta) => `${meta.label} (${meta.key})`);\n  return { intro, options, metas: SIDTHIE_VALUES };\n}\n\nfunction resolveSidthieFromOption(option: string): SidthieMeta | null {\n  if (!option) return null;\n  const keyMatch = option.match(/\\(([A-Za-z]+)\\)\\s*$/);\n  if (keyMatch) {\n    const meta = findSidthieByKey(keyMatch[1]);\n    if (meta) return meta;\n  }\n  const label = option.replace(/\\([^)]*\\)/g, '').trim();\n  return findSidthieByLabel(label);\n}\n\nclass BlessChatWidget {\n  private container: HTMLElement;\n  private options: Required<WidgetOptions>;\n  private messages: Message[] = [];\n  private isProcessing = false;\n  private blessingDelivered = false;\n\n  private messageList!: HTMLElement;\n  private inputEl!: HTMLInputElement;\n  private sendBtn!: HTMLButtonElement;\n  private statusEl!: HTMLElement;\n  private errorEl!: HTMLElement;\n  private currentStreamingNode: HTMLDivElement | null = null;\n  private currentStreamingText = '';\n  private activeSidthie: SidthieMeta | null = null;\n\n  constructor(container: HTMLElement, options?: WidgetOptions) {\n    this.container = container;\n    const merged = { ...DEFAULTS, ...(options || {}) };\n    this.options = {\n      apiUrl: sanitizeString(merged.apiUrl) ?? DEFAULTS.apiUrl,\n      placeholder: sanitizeString(merged.placeholder) ?? DEFAULTS.placeholder,\n      sendAriaLabel: sanitizeString(merged.sendAriaLabel) ?? DEFAULTS.sendAriaLabel,\n      loadingText: sanitizeString(merged.loadingText) ?? DEFAULTS.loadingText,\n      requireBlessing: merged.requireBlessing\n    };\n    this.blessingDelivered = getSessionFlag(SESSION_KEY) === 'true';\n  }\n\n  mount() {\n    this.container.innerHTML = '';\n    this.container.classList.add('bless-chat-shell');\n\n    const windowEl = document.createElement('div');\n    windowEl.className = 'bless-chat-window';\n\n    this.messageList = document.createElement('div');\n    this.messageList.className = 'bless-chat-messages';\n\n    this.statusEl = document.createElement('div');\n    this.statusEl.className = 'bless-chat-bubble bless-chat-bubble--status';\n    this.statusEl.hidden = true;\n\n    this.errorEl = document.createElement('div');\n    this.errorEl.className = 'bless-chat-error';\n    this.errorEl.hidden = true;\n\n    const form = document.createElement('form');\n    form.className = 'bless-chat-input-row';\n\n    const wrapper = document.createElement('div');\n    wrapper.className = 'bless-chat-input-wrapper';\n\n    this.inputEl = document.createElement('input');\n    this.inputEl.type = 'text';\n    this.inputEl.className = 'bless-chat-input';\n    this.inputEl.placeholder = this.options.placeholder;\n    this.inputEl.autocomplete = 'off';\n    this.inputEl.spellcheck = false;\n    this.inputEl.setAttribute('aria-label', this.options.placeholder);\n\n    wrapper.appendChild(this.inputEl);\n\n    this.sendBtn = document.createElement('button');\n    this.sendBtn.type = 'submit';\n    this.sendBtn.className = 'bless-chat-send';\n    this.sendBtn.setAttribute('aria-label', this.options.sendAriaLabel);\n    this.sendBtn.innerHTML = svgArrow();\n\n    form.append(wrapper, this.sendBtn);\n\n    form.addEventListener('submit', (event) => {\n      event.preventDefault();\n      this.handleSubmit();\n    });\n\n    this.messageList.addEventListener('scroll', () => {\n      if (this.messageList.scrollTop === 0) {\n        this.messageList.classList.add('scrolled-top');\n      } else {\n        this.messageList.classList.remove('scrolled-top');\n      }\n    });\n\n    windowEl.append(this.messageList, this.statusEl, form, this.errorEl);\n    this.container.appendChild(windowEl);\n\n    this.inputEl.addEventListener('keydown', (event) => {\n      if (event.key === 'Enter' && !event.shiftKey) {\n        event.preventDefault();\n        this.handleSubmit();\n      }\n    });\n\n    if (this.blessingDelivered) {\n      this.pushAssistantMessage('Your blessing has already been crafted. Scroll to revisit it below.');\n    } else {\n      this.startConversation();\n    }\n  }\n\n  private async startConversation() {\n    this.activeSidthie = null;\n    await this.fetchAssistantReply();\n  }\n\n  private async handleSubmit() {\n    if (this.isProcessing) return;\n\n    const value = this.inputEl.value.trim();\n    if (!value) {\n      this.inputEl.reportValidity();\n      return;\n    }\n\n    if (this.blessingDelivered && this.options.requireBlessing) {\n      this.pushAssistantMessage('Your blessing has been created. Scroll down to read it.');\n      this.inputEl.value = '';\n      return;\n    }\n\n    this.appendMessage({ role: 'user', content: value });\n    this.inputEl.value = '';\n    this.messages.push({ role: 'user', content: value });\n    await this.fetchAssistantReply();\n  }\n\n  /**\n   * Render a message bubble to the UI. When the assistant sends a message that\n   * contains a numbered list of seven options, replace the bubble with interactive\n   * buttons so the user can tap to choose an intention.\n   */\n  private appendMessage(message: Message, isStreaming = false) {\n    // Detect enumerated Sidthie list in assistant messages (not streaming).  If found,\n    // show buttons instead of plain text.  Insert newlines before numbers to catch\n    // cases where the model outputs them in a single line.\n    if (message.role === 'assistant' && !isStreaming) {\n      const parsed = parseSidthieOptions(message.content);\n      if (parsed) {\n        this.messages.push({ role: 'assistant', content: message.content });\n        this.createOptionsBubble(parsed.options, parsed.intro, parsed.metas);\n        return;\n      }\n    }\n\n    const bubble = document.createElement('div');\n    bubble.className = 'bless-chat-bubble';\n    if (message.role === 'user') {\n      bubble.classList.add('bless-chat-bubble--user');\n    }\n\n    bubble.textContent = message.content;\n    this.messageList.appendChild(bubble);\n    this.scrollToBottom();\n\n    if (message.role === 'assistant' && isStreaming) {\n      this.currentStreamingNode = bubble;\n      this.currentStreamingText = message.content;\n    }\n  }\n\n  /**\n   * Create a bubble containing a set of buttons for the seven Sidthies.  If an\n   * introductory sentence is provided, it is rendered above the buttons.\n   */\n  private createOptionsBubble(options: string[], intro: string, metas?: SidthieMeta[]) {\n    this.activeSidthie = null;\n\n    if (intro) {\n      const introBubble = document.createElement('div');\n      introBubble.className = 'bless-chat-bubble';\n      introBubble.textContent = intro;\n      this.messageList.appendChild(introBubble);\n      this.scrollToBottom();\n    }\n\n    const bubble = document.createElement('div');\n    bubble.className = 'bless-chat-bubble';\n    const container = document.createElement('div');\n    container.className = 'bless-chat-options';\n    options.forEach((opt, index) => {\n      const btn = document.createElement('button');\n      btn.type = 'button';\n      btn.className = 'bless-chat-option';\n      btn.textContent = opt;\n      btn.addEventListener('click', () => {\n        const meta = metas?.[index] ?? resolveSidthieFromOption(opt);\n        if (meta) {\n          this.activeSidthie = meta;\n          try {\n            window.dispatchEvent(\n              new CustomEvent('sidthie:selected', {\n                detail: { sidthie: meta.key, sidthieLabel: meta.label },\n              })\n            );\n          } catch {\n            /* ignore dispatch errors */\n          }\n        }\n        // When a user selects an option, record it and continue the conversation\n        this.appendMessage({ role: 'user', content: opt });\n        this.messages.push({ role: 'user', content: opt });\n        // Disable all options after selection\n        container.querySelectorAll('button').forEach((b) => {\n          (b as HTMLButtonElement).disabled = true;\n        });\n        this.fetchAssistantReply();\n      });\n      container.appendChild(btn);\n    });\n    bubble.appendChild(container);\n    this.messageList.appendChild(bubble);\n    this.scrollToBottom();\n  }\n\n  private updateStreamingBubble(delta: string) {\n    if (!this.currentStreamingNode) return;\n    this.currentStreamingText += delta;\n    this.currentStreamingNode.textContent = this.currentStreamingText;\n    this.scrollToBottom();\n  }\n\n  private finalizeStreamingBubble(finalText: string) {\n    if (this.currentStreamingNode) {\n      const parsed = parseSidthieOptions(finalText);\n      if (parsed) {\n        this.messageList.removeChild(this.currentStreamingNode);\n        this.currentStreamingNode = null;\n        this.currentStreamingText = '';\n        this.createOptionsBubble(parsed.options, parsed.intro);\n        return;\n      }\n      this.currentStreamingNode.textContent = finalText.trim();\n    }\n    this.currentStreamingNode = null;\n    this.currentStreamingText = '';\n    this.scrollToBottom();\n  }\n\n  private pushAssistantMessage(text: string) {\n    const message = { role: 'assistant', content: text } as Message;\n    this.appendMessage(message);\n    this.messages.push(message);\n  }\n\n  private setStatus(text?: string, typing = false) {\n    if (text) {\n      if (typing) {\n        this.statusEl.innerHTML =\n          '<span class=\"bless-typing\" aria-hidden=\"true\"><span></span><span></span><span></span></span>';\n        this.statusEl.classList.add('is-typing');\n        this.statusEl.setAttribute('aria-label', text);\n      } else {\n        this.statusEl.textContent = text;\n        this.statusEl.classList.remove('is-typing');\n        this.statusEl.removeAttribute('aria-label');\n      }\n      this.statusEl.hidden = false;\n    } else {\n      this.statusEl.hidden = true;\n      this.statusEl.classList.remove('is-typing');\n      this.statusEl.innerHTML = '';\n      this.statusEl.removeAttribute('aria-label');\n    }\n  }\n\n  private setError(message?: string) {\n    if (message) {\n      this.errorEl.textContent = message;\n      this.errorEl.hidden = false;\n    } else {\n      this.errorEl.hidden = true;\n      this.errorEl.textContent = '';\n    }\n  }\n\n  private scrollToBottom() {\n    requestAnimationFrame(() => {\n      this.messageList.scrollTop = this.messageList.scrollHeight;\n    });\n  }\n\n  private async fetchAssistantReply() {\n    this.isProcessing = true;\n   this.sendBtn.disabled = true;\n   this.setError();\n    this.setStatus(this.options.loadingText, true);\n\n    const controller = new AbortController();\n\n    try {\n      const response = await fetch(this.options.apiUrl, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ messages: this.messages }),\n        signal: controller.signal\n      });\n\n      if (!response.ok) {\n        const data = await safeJson(response);\n        throw new Error(data?.error || `Request failed with status ${response.status}`);\n      }\n\n      if (isStreamResponse(response)) {\n        await this.handleStream(response);\n      } else {\n        const data = await response.json();\n        const text = (data?.message as string) || '';\n        const done = Boolean(data?.done);\n        if (text) {\n          const cleaned = cleanAssistantText(text);\n          const payload = cleaned || text;\n          this.appendMessage({ role: 'assistant', content: payload });\n          this.messages.push({ role: 'assistant', content: payload });\n          this.onAssistantComplete(payload, done);\n          this.setStatus();\n        }\n      }\n    } catch (error: any) {\n      console.error('Bless chat error', error);\n      this.setError(error?.message || 'Something went wrong. Please try again.');\n      this.pushAssistantMessage('I could not continue the conversation. Let us try once more when you are ready.');\n    } finally {\n      this.setStatus();\n      this.isProcessing = false;\n      this.sendBtn.disabled = false;\n    }\n  }\n\n  private async handleStream(response: Response) {\n    const reader = response.body?.getReader();\n    if (!reader) {\n      const fallback = await response.text();\n      this.pushAssistantMessage(fallback);\n      return;\n    }\n\n    let doneFlag = false;\n    let finalText = '';\n    let aggregated = '';\n\n    this.appendMessage({ role: 'assistant', content: '' }, true);\n\n    const decoder = new TextDecoder();\n    let buffer = '';\n\n    while (true) {\n      const { value, done } = await reader.read();\n      if (done) break;\n      buffer += decoder.decode(value, { stream: true });\n\n      const frames = buffer.split('\\n\\n');\n      buffer = frames.pop() || '';\n\n      for (const frame of frames) {\n        const lines = frame.split('\\n');\n        let data = '';\n\n        for (const line of lines) {\n          if (line.startsWith('data:')) {\n            data += line.slice(5).trim();\n          }\n        }\n\n        if (!data) continue;\n        if (data === '[DONE]') continue;\n\n        let payload: any;\n        try {\n          payload = JSON.parse(data);\n        } catch (error) {\n          console.warn('Unable to parse stream chunk', data);\n          continue;\n        }\n\n        if (payload.type === 'response.delta' && typeof payload.delta === 'string') {\n          aggregated += payload.delta;\n          this.updateStreamingBubble(payload.delta);\n        } else if (payload.type === 'response.output_text.delta' && typeof payload.textDelta === 'string') {\n          aggregated += payload.textDelta;\n          this.updateStreamingBubble(payload.textDelta);\n        } else if (payload.type === 'response.message.delta' && typeof payload.delta === 'string') {\n          aggregated += payload.delta;\n          this.updateStreamingBubble(payload.delta);\n        } else if (payload.type === 'response.completed' || payload.type === 'response.stop') {\n          // handled after the stream ends\n        } else if (payload.type === 'meta' && typeof payload.done === 'boolean') {\n          doneFlag = payload.done;\n        } else if (payload.type === 'final' && typeof payload.text === 'string') {\n          finalText = payload.text;\n          if (typeof payload.done === 'boolean') {\n            doneFlag = payload.done;\n          }\n        } else if (payload.type === 'error') {\n          throw new Error(payload.message || 'Unexpected error');\n        }\n      }\n    }\n\n    const resolved = (finalText || aggregated).trim();\n    const cleaned = cleanAssistantText(resolved);\n    const output = cleaned || resolved;\n    this.finalizeStreamingBubble(output);\n    this.messages.push({ role: 'assistant', content: output });\n    this.onAssistantComplete(output, doneFlag);\n  }\n\n  private onAssistantComplete(text: string, done: boolean) {\n    if (!text) return;\n\n    if (done) {\n      const prepared = this.prepareBlessing(text);\n      const blessing = prepared.blessing || prepared.raw || text.trim();\n      this.blessingDelivered = true;\n      setSessionFlag(SESSION_KEY, 'true');\n\n      const last = this.messageList.lastElementChild;\n      if (last && last.classList.contains('bless-chat-bubble')) {\n        this.messageList.removeChild(last);\n      }\n\n      this.displayBlessing(blessing);\n      this.pushAssistantMessage('Your blessing has been created! Scroll down to read it.');\n      return;\n    }\n\n    if (/image|upload|photo|picture/i.test(text)) {\n      this.pushAssistantMessage('No image is needed. Let us continue in words.');\n    }\n  }\n\n  private prepareBlessing(raw: string) {\n    const cleaned = cleanAssistantText(raw);\n    const lines = cleaned\n      .split(/\\r?\\n/)\n      .map((line) => line.trim())\n      .filter(Boolean);\n\n    const poem: string[] = [];\n    const extra: string[] = [];\n    for (const line of lines) {\n      if (poem.length < 5 && !/^is the blessing/i.test(line)) {\n        poem.push(line);\n      } else if (!/^is the blessing/i.test(line)) {\n        extra.push(line);\n      }\n    }\n\n    return {\n      blessing: poem.join('\\n'),\n      extra,\n      raw: cleaned,\n    };\n  }\n\n  private displayBlessing(blessing: string) {\n    const meta = this.activeSidthie;\n    const detail = {\n      text: blessing,\n      blessing,\n      sidthie: meta?.key,\n      sidthieLabel: meta?.label,\n      explanation: meta?.description || meta?.short,\n    };\n\n    this.renderBlessingPanel(detail);\n    if (meta) {\n      try {\n        window.dispatchEvent(\n          new CustomEvent('sidthie:selected', {\n            detail: { sidthie: meta.key, sidthieLabel: meta.label },\n          })\n        );\n      } catch {\n        /* ignore dispatch errors */\n      }\n    }\n    window.dispatchEvent(\n      new CustomEvent('blessing:update', {\n        detail,\n      })\n    );\n  }\n\n  private renderBlessingPanel(detail: {\n    blessing: string;\n    explanation?: string;\n    sidthieLabel?: string;\n  }) {\n    const sel = [\n      '[data-bless-panel]',\n      '.bless-blessing__panel',\n      '#bless-blessing__panel'\n    ].join(',');\n\n    document.querySelectorAll<HTMLElement>(sel).forEach((panel) => {\n      panel.style.fontFamily = \"'Cormorant Upright', serif\";\n      panel.style.whiteSpace = 'pre-line';\n      panel.style.textAlign = 'center';\n      panel.style.color = '#fff';\n      panel.style.fontSize = 'clamp(18px, 2.4vw, 30px)';\n      panel.style.lineHeight = '1.35';\n      panel.style.textShadow = '0 2px 8px rgba(0,0,0,.55)';\n\n      const content = panel.querySelector<HTMLElement>('[data-blessing-output]') || panel;\n      content.textContent = detail.blessing;\n      content.removeAttribute('hidden');\n\n      const meta = panel.querySelector<HTMLElement>('[data-blessing-meta]');\n      const metaTitle = panel.querySelector<HTMLElement>('[data-sidthie-title]');\n      const metaText = panel.querySelector<HTMLElement>('[data-sidthie-excerpt]');\n\n      if (meta) {\n        const hasLabel = Boolean(detail.sidthieLabel);\n        const hasExplanation = Boolean(detail.explanation);\n\n        if (metaTitle) {\n          if (hasLabel) {\n            metaTitle.textContent = detail.sidthieLabel!;\n            metaTitle.removeAttribute('hidden');\n          } else {\n            metaTitle.setAttribute('hidden', 'hidden');\n          }\n        }\n\n        if (metaText) {\n          if (hasExplanation) {\n            metaText.textContent = detail.explanation!;\n            metaText.removeAttribute('hidden');\n          } else {\n            metaText.setAttribute('hidden', 'hidden');\n          }\n        }\n\n        if (hasLabel || hasExplanation) {\n          meta.removeAttribute('hidden');\n        } else {\n          meta.setAttribute('hidden', 'hidden');\n        }\n      }\n\n      const signup = panel.querySelector<HTMLElement>('[data-blessing-signup]');\n      const signupPrompt = panel.querySelector<HTMLElement>('[data-signup-prompt]');\n      const signupInput = panel.querySelector<HTMLInputElement>('[data-signup-sidthie]');\n      const defaultPrompt = signupPrompt?.getAttribute('data-default-prompt') || signupPrompt?.textContent || '';\n\n      if (signup) {\n        if (signupPrompt) {\n          if (defaultPrompt.includes('{sidthie}')) {\n            signupPrompt.textContent = defaultPrompt.replace('{sidthie}', detail.sidthieLabel || 'your Sidthie');\n          } else if (detail.sidthieLabel) {\n            signupPrompt.textContent = `${defaultPrompt} (${detail.sidthieLabel})`;\n          }\n        }\n        if (signupInput) {\n          signupInput.value = detail.sidthieLabel || '';\n        }\n        signup.removeAttribute('hidden');\n      }\n    });\n  }\n}\n\nfunction safeJson(response: Response) {\n  return response\n    .clone()\n    .json()\n    .catch(() => ({}));\n}\n\nfunction isStreamResponse(response: Response) {\n  const contentType = response.headers.get('Content-Type') || response.headers.get('content-type');\n  return contentType ? /ndjson|stream/.test(contentType) : false;\n}\n\nfunction resolveContainerConfig(element: HTMLElement): WidgetOptions {\n  const api = sanitizeString(element.dataset.apiUrl);\n  const placeholder = sanitizeString(element.dataset.placeholder);\n  const loading = sanitizeString(element.dataset.loadingText);\n  return {\n    apiUrl: api,\n    placeholder,\n    loadingText: loading\n  };\n}\n\nfunction mount(selector?: string, options?: WidgetOptions) {\n  const target = selector\n    ? document.querySelector<HTMLElement>(selector)\n    : document.querySelector<HTMLElement>('[data-chat-container]');\n\n  if (!target) {\n    console.warn('BlessChat: target container not found.');\n    return;\n  }\n\n  console.info('BlessChat: mounting widget', { selector, target });\n\n  const config = { ...resolveContainerConfig(target), ...(options || {}) };\n  const widget = new BlessChatWidget(target, config);\n  widget.mount();\n}\n\nif (typeof window !== 'undefined') {\n  (window as any).BlessChat = {\n    mount\n  };\n\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => mount());\n  } else {\n    setTimeout(() => mount(), 0);\n  }\n}\n\nexport { mount };\n"],
  "mappings": "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",
  "names": ["index_exports", "__export", "mount", "DEFAULTS", "sanitizeString", "value", "trimmed", "lower", "STYLE_BLOCK", "styleEl", "SIDTHIE_META", "SIDTHIE_VALUES", "findSidthieByKey", "key", "_a", "upper", "findSidthieByLabel", "text", "_b", "meta", "svgArrow", "SESSION_KEY", "CLEAN_PATTERNS", "cleanAssistantText", "message", "cleaned", "pattern", "getSessionFlag", "setSessionFlag", "parseSidthieOptions", "payload", "processed", "lines", "line", "intro", "SIDTHIE_VALUES", "meta", "options", "resolveSidthieFromOption", "option", "keyMatch", "findSidthieByKey", "label", "findSidthieByLabel", "BlessChatWidget", "container", "_a", "_b", "_c", "_d", "merged", "DEFAULTS", "sanitizeString", "getSessionFlag", "SESSION_KEY", "windowEl", "form", "wrapper", "svgArrow", "event", "value", "message", "isStreaming", "parsed", "bubble", "metas", "introBubble", "opt", "index", "btn", "b", "delta", "finalText", "text", "typing", "controller", "response", "data", "safeJson", "isStreamResponse", "done", "cleanAssistantText", "error", "reader", "fallback", "doneFlag", "aggregated", "decoder", "buffer", "frames", "frame", "resolved", "output", "prepared", "blessing", "setSessionFlag", "last", "raw", "cleaned", "poem", "extra", "detail", "sel", "panel", "content", "metaTitle", "metaText", "hasLabel", "hasExplanation", "signup", "signupPrompt", "signupInput", "defaultPrompt", "contentType", "resolveContainerConfig", "element", "api", "placeholder", "loading", "mount", "selector", "target", "config"]
}
